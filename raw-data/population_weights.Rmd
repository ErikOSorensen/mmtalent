---
title: "Population weights"
author: "Erik"
date: "November 28, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require('tidyverse')
require('readr')
```

The point of this file is to create population weights that can be used to 
reweight the "Research Now" data to nationally representative for the
US with respect to some basic demographics. I Have downloaded
raw data from the 
[Census bureau](https://www2.census.gov/programs-surveys/popest/datasets/2010-2016/state/asrh/) on November 28, 2017 at which time the data file
was time-stamped "22-Jun-2017 09:07".

Reading in the raw data
```{r}
census_df <- read_csv("sc-est2016-alldata6.csv", quote="") %>%
  filter(SEX %in% c(1,2)) %>% 
  filter(ORIGIN==0) %>%
  filter(AGE>=18) %>%
  mutate(age_category = cut(AGE, breaks=c(18, 35, 45, 55, 65, 120), right=FALSE)) %>%
  group_by(REGION, age_category, SEX) %>%
  summarize(n2016 = sum(POPESTIMATE2016)) %>%
  mutate(gender = factor(SEX, labels=c("male", "female"))) %>%
  select(REGION, gender, age_category, n2016)  %>% ungroup()
census_df$region = factor(census_df$REGION, labels=c("Northeast", "Midwest", "South", "West"))
census_df <- census_df %>% select(region, gender, age_category, n2016)
```

This dataframe now has the data needed to reweigth the "Research Now" data. I save it to 
a file.
```{r}
populationweights2016 <- census_df
save(populationweights2016, file="../data/populationweights2016.rda")
head(populationweights2016)
```


