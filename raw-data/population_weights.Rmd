---
title: "Population weights"
author: "Erik Ø. Sørensen"
date: "July 9, 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require('tidyverse')
require('readr')
```

The point of this file is to create population weights that can be used to 
reweigh the "Research Now" data to nationally representative for the
US with respect to some basic demographics. I Have downloaded
raw data from the 
[Census bureau](https://www2.census.gov/programs-surveys/popest/datasets/2010-2017/state/asrh/) 
on July 9, 2021 at which time the data file was time-stamped "21-Jun-2018 10:04".

Reading in the raw data
```{r}
census_df <- read_csv("sc-est2017-alldata6.csv", quote="") %>%
  filter(SEX %in% c(1,2)) %>% 
  filter(ORIGIN==0) %>%
  filter(AGE>=18) %>%
  mutate(age_category = cut(AGE, breaks=c(18, 35, 45, 55, 65, 120), right=FALSE)) %>%
  group_by(REGION, age_category, SEX) %>%
  summarize(n2017 = sum(POPESTIMATE2017)) %>%
  mutate(gender = factor(SEX, labels=c("male", "female"))) %>%
  select(REGION, gender, age_category, n2017)  %>% ungroup()
census_df$region = factor(census_df$REGION, labels=c("Northeast", "Midwest", "South", "West"))
census_df <- census_df %>% select(region, gender, age_category, n2017)
```

This dataframe now has the data needed to reweight the "Research Now" data. I save it to 
a file.
```{r}
populationweights2017 <- census_df %>% mutate(region = as.character(region),
                                              gender = as.character(gender),
                                              age_category = as.character(age_category))
saveRDS(populationweights2017, file=here::here("data", "populationweights2017.rds"))
head(populationweights2017)
```


