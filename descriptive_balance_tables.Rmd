---
title: "Descriptive and balance tables"
author: "Erik Ø. Sørensen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(targets)
require(tidyverse)
require(gt)
```



# Descriptive table

```{r Descriptive Table}
tar_load(descriptive_table_gt)
descriptive_table_gt
descriptive_table_gt %>% as_latex() %>%
  as.character() %>%
  cat(file=here::here("tables","descriptive_table.tex"))
```

# Balance table (background characteristics)

```{r Balance Table}
tar_load(background_balance_formatted)
background_balance_formatted
background_balance_formatted %>% as_latex() %>%
  as.character() %>%
  cat(file=here::here("tables","background_balance_table.tex"))
```

The distributions. First for education.

```{r}
tar_load(mmtalent)
edu_table <- mmtalent %>%
  count(edu_category, name = "Frequency") %>%
  mutate(
    Proportion = Frequency / sum(Frequency),
    Cumulative_Proportion = cumsum(Proportion)
  )
edu_table |> gt() |> fmt_number(decimals = 3, columns = 3:4)
```
So above median education means Bachelor and above.

Income: 

```{r}
income_table <- mmtalent %>%
  count(income_category, name = "Frequency") %>%
  mutate(
    Proportion = Frequency / sum(Frequency),
    Cumulative_Proportion = cumsum(Proportion)
  )
income_table |> gt() |> fmt_number(decimals = 3, columns = 3:4)
```

Age:
```{r}
median(mmtalent$age)
```




# Balance on survey outcomes
The survey was run after the experiment, so should not be influenced to any great degree
by treatment assignment.

```{r}
tar_load(survey_balance_formatted)
survey_balance_formatted
survey_balance_formatted %>% 
  as_latex() %>%
  as.character() %>%
  cat(file=here::here("tables","survey_balance_table.tex"))
```

What happens if we merge the personal/impersonal treatment?

```{r}
tar_load(survey_balance_formatted_timing)
survey_balance_formatted_timing
survey_balance_formatted_timing %>% 
  as_latex() %>%
  as.character() %>%
  cat(file=here::here("tables","survey_balance_table_timing.tex"))
```

## Consort diagram
```{r Consort diagram, echo=FALSE}
tar_load(consort_diagram)
consort_diagram
ggsave(here::here("figures","EEREV-D-24-01375_Figure_1.pdf"), plot = consort::build_grid(consort_diagram), width=16, height = 8, units="in")
```




