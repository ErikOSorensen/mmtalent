---
title: "Experiment outcomes"
author: "Erik Ø. Sørensen"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(targets)
require(tidyverse)
require(gt)
require(patchwork)
```


# Histogram of distributions
```{r echo=FALSE}
tar_load(histogram_distribution_graph)
histogram_distribution_graph
ggsave(here::here("figures","histogram_transfers.pdf"), width = 16, height = 10, units = "cm")
```


# Graph with average outcomes
```{r echo=FALSE}
tar_load(average_distributions_graph)
average_distributions_graph
ggsave(here::here("figures","average_ginis.pdf"), width = 16, height = 10, units = "cm")
```

# Regressions

We look at two different outcomes. The first is the gini coefficient, which (as before) is between 0 and 0.6 (there is a
base income of (2,2) that cannot be lowered, so max inequality is (8,2) or (2,8)). 
The second outcome is a dummy indicator for maximum inequality (or giving nothing to the 
worst off, "nothingtw" in the table below). 


```{r}
outcome_names <- c('treatmentExAntePersonal' = 'Ex Ante Personal (d)',
                   'treatmentExPostImpersonal' = 'Ex Post Impersonal (d)',
                   'treatmentExPostPersonal' = 'Ex Post Personal (d)',
                  'age' = 'Age (years)',
                  'age_high' = 'High age (d)',
                  'leftTRUE' = 'Left (d)',
                  'high_incomeTRUE' = 'High income (d)',
                  'high_eduTRUE' = 'High education (d)',
                  'maleTRUE' = 'Male (d)',
                  '(Intercept)'='(Intercept)')
```



```{r echo=FALSE}
tar_load(implemented_inequality_list)
reg1 <- modelsummary::modelsummary(implemented_inequality_list,
                           stars = c('*'=0.1, '**'=0.05, '***'=0.01),
                           coef_map = outcome_names,
                           output = "gt",
                           gof_omit = "R2 Adj.|se_type|AIC|BIC|Log.Lik.|F") |>
  tab_spanner(label="Gini", columns=2:3) |> 
  tab_spanner(label="Nothing to worst of", columns = 4:5)
reg1
reg1 |> as_latex() |>
  cat(file=here::here("tables","inequality_treatment_regression.tex"))
```

# Graph of shares at extreme distributions

```{r}
tar_load(extreme_shares_graph)
extreme_shares_graph$a + extreme_shares_graph$b + plot_annotation(tag_levels = 'a')
ggsave(here::here("figures", "extreme_shares.pdf"), width = 16, height = 10, units = 'cm')
```


## Heterogeneity in treatment outcomefs

Needs a new list of labels

```{r}
outcome_names_het1 <- c('timingExPost' = 'Ex Post (d)',
                   'timingExPost:age_high' = "Ex Post X High age",
                   'timingExPost:leftTRUE' = "Ex Post X Left",
                   'timingExPost:high_eduTRUE' = "Ex Post X High education",
                   'timingExPost:high_incomeTRUE' = "Ex Post X High income",
                   'timingExPost:maleTRUE' = "Ex Post X male",
                  'age_high' = 'High age (d)',
                  'leftTRUE' = 'Left (d)',
                  'high_incomeTRUE' = 'High income (d)',
                  'high_eduTRUE' = 'High education (d)',
                  'maleTRUE' = 'Male (d)',
                  '(Intercept)'='(Intercept)')
```



```{r}
tar_load(implemented_inequality_heterogeneity_list)
lst1 <- modelsummary::modelsummary(implemented_inequality_heterogeneity_list$A,
                           stars = c('*'=0.1, '**'=0.05, '***'=0.01),
                           coef_map = outcome_names_het1,
                           output = "gt",
                           gof_omit = "R2 Adj.|se_type|AIC|BIC|Log.Lik.|F|RMSE") |>
  tab_spanner(label="Gini", columns=2:6) 
lst1
lst1 |> as_latex() |>
  cat(file=here::here("tables","inequality_treatment_regression_het1.tex"))
```

I try the same for nothing to least off and a joint table.


```{r}
tar_load(implemented_inequality_heterogeneity_list)
lst2 <- modelsummary::modelsummary(implemented_inequality_heterogeneity_list$B,
                           stars = c('*'=0.1, '**'=0.05, '***'=0.01),
                           coef_map = outcome_names_het1,
                           output = "gt",
                           gof_omit = "R2 Adj.|se_type|AIC|BIC|Log.Lik.|F|RMSE") |>
  tab_spanner(label="Nothing to worst off", columns=2:6) 
lst2
lst2 |> as_latex() |>
  cat(file=here::here("tables","inequality_treatment_regression_het2.tex"))
```

```{r}
tar_load(implemented_inequality_heterogeneity_list)
lst3 <- modelsummary::modelsummary(implemented_inequality_heterogeneity_list$All,
                           stars = c('*'=0.1, '**'=0.05, '***'=0.01),
                           coef_map = outcome_names_het1,
                           output = "gt",
                           gof_omit = "R2 Adj.|se_type|AIC|BIC|Log.Lik.|F|RMSE") |>
  tab_spanner(label="Gini", columns=2:6) |>
  tab_spanner(label="Nothing to worst off", columns=7:11)
lst3
lst3 |> as_latex() |>
  cat(file=here::here("tables","inequality_treatment_regression_het3.tex"))
```

